<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OCTI TEST</title>
  <style>
     /* ===============================
       COLOR GUIDE (change per personality)
       ===============================
       --hero-color: main background colour of the header
       --hero-text: text colour inside the header
       --accent: highlight colour for titles, small buttons
       --page-bg: page background
       =============================== */

    :root{
      --hero-color: #696969; /* light blue — change this to personality theme colour */
      --hero-text: #FFFFFF; /* text colour on hero */
      --accent: #FFFFFF; /* accent colour for links/titles */
      --page-bg: #FFFFFF; /* overall background */
      --max-width: 900px;
      --body-text: #222;
      --muted: #444;
      --radius: 12px;
      --gap: 28px;
    }

    *{box-sizing: border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--page-bg);
      color: var(--body-text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.55;
    }

    /* ===============================
       HEADER BAR (top navigation)
       =============================== */
    header.site-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--hero-color);
      color: var(--hero-text);
      padding: 12px 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .logo-area{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-placeholder{
      width:40px;
      height:auto;
      border-radius:8px;
      background:rgba(0,0,0,0);
    }

    .site-title{
      font-weight:700;
      font-size:18px;
      color: var(--hero-text);
    }

    .nav-links{
      display:flex;
      gap:18px;
    }

    .nav-links a{
      text-decoration:none;
      color:var(--hero-text);
      font-weight:500;
      font-size:15px;
      transition:opacity .2s;
    }

    .nav-links a:hover{opacity:0.7;}

    /* ===============================
       HERO SECTION
       =============================== */
    .hero{
      background: linear-gradient(180deg, var(--hero-color) 0%, color-mix(in srgb, var(--hero-color) 80%, white) 100%);
      color: var(--hero-text);
      padding: 64px 20px;
      text-align: left;
      clip-path: polygon(0 0, 100% 0, 100% 80%, 0 100%);
    }

    .container{max-width:var(--max-width);margin:0 auto;padding:0 20px}

    .title-row{display:flex;align-items:baseline;gap:18px}
    h1{font-size:44px;margin:0;line-height:1;}
    .code{font-size:18px;padding:6px 12px;border-radius:999px;background:rgba(0,0,0,0.06);color:var(--accent);font-weight:600}
    .subtitle{margin-top:12px;color:#FFFFFF(--muted);font-size:18px}
	
	.type-quote{
  font-style: italic;
  color: var(--muted);
  font-size: 25px;
  line-height: 1.6;
  margin-bottom: 24px;
  padding-left: 16px;
  border-left: 3px solid var(--accent);
  opacity: 0.9;
}

	.type-quote .quote-author{
  display: block;
  margin-top: 8px;
  font-size: 15px;
  font-weight: 500;
  color: var(--accent);
  text-align: right;
  padding-right: 10px;
}


    .card{
      background:white;
      border-radius:var(--radius);
      padding:28px;
      margin-top:var(--gap);
      box-shadow: 0 6px 20px rgba(8,30,50,0.06);
    }

    h2{margin:0 0 12px 0;color:var(--accent);font-size:20px}
    p{margin:0 0 16px 0;font-size:16px}

    .list{margin:12px 0 18px 0;padding-left:18px}
    .list li{margin:10px 0}
    .sep{height:1px;background:linear-gradient(90deg,transparent,rgba(0,0,0,0.06),transparent);margin:22px 0;border-radius:2px}

    /* small screens */
    @media (max-width:640px){
      h1{font-size:34px}
      .hero{padding:48px 16px}
      .nav-links{display:none;}
    }

    /* utility */
    .muted{color:var(--muted)}
    .strong{font-weight:700}
    /* Monochrome theme — black & white only.
       To customise layout/text, edit the HTML below; there are no colour variables. */
    :root{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    html,body{height:100%;}
    body{
      background:#ffffff;
      margin:0;
   
      color:#000000;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }



    .question{margin:12px 0;padding:14px;border-radius:10px;background:#fff;border:1px solid #f3f3f3}
    .qtitle{font-weight:700;margin-bottom:10px;color:#000}
    .options{display:flex;gap:10px;flex-wrap:wrap}
    label.option{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;background:#ffffff;border:1px solid #f2f2f2;cursor:pointer;font-size:14px;color:#0b0b0b;
      min-width:220px;
    }
    label.option:hover{background:#fafafa}
    input[type=radio]{ /* default styling — no accent-colour overrides to keep monochrome */ width:16px;height:16px;margin:0}

    .controls{display:flex;gap:12px;align-items:center;margin-top:14px}
    button{cursor:pointer;padding:10px 14px;border-radius:10px;border:1px solid #111;background:#111;color:#fff;font-weight:700}
    button.secondary{background:#fff;color:#111;border:1px solid #e2e2e2;font-weight:700}
    button.secondary:hover{background:#fafafa}

    .muted{color:#555;font-size:13px}
    .result{margin-top:18px;padding:18px;border-radius:12px;background:#fafafa;color:#000;border:1px solid #eee;display:none}
    .result h2{margin:8px 0 0;font-size:18px}
    .result .code{font-weight:900;font-size:16px}
    .note{font-size:13px;color:#333;margin-top:8px}
    .alert{background:#fff3cd;color:#92400e;padding:10px;border-radius:8px;margin-top:10px;display:none;border:1px solid #f5e6b8}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* responsive */
    @media (max-width:700px){
      .options{flex-direction:column}
      label.option{min-width:unset;width:100%}
      .nav-links{display:none}
    }

    /* small explanatory footer */
    .footer-note{margin-top:18px;font-size:13px;color:#444}
    .bar-wrap { background:#eee;border-radius:999px;height:12px;width:100%;overflow:hidden;margin-top:6px;}
    .bar { height:100%; border-radius:999px; background:#111; width:0%; transition:width .6s ease;}
    .pct { font-weight:700; margin-left:8px; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="logo-area">
      <img src="arc_white.png" alt="Anthemia logo" class="logo-placeholder"></img>
      <div class="site-title">OCTI by A.R.C.</div>
    </div>
    <nav class="nav-links">
     
      <a href="index.html">Test Explanation</a>
	  <a href="alltype.html">All Types</a>
      <a href="history.html">History</a>
      <a href="author.html">Creator</a>
    </nav>
  </header>

  <section class="hero">
    <div class="container">
      <div class="title-row">
        <h1>Operational Cognition & Temperament Index. </h1>
    
      </div>
      <div class="subtitle">Simple question, answer them all.</div>
    </div>
  </section>

     <main class="container">
	<section class="card">
    
      <!-- QUESTIONS -->
      <section aria-labelledby="env">
        <h3 id="env">I. Environment (A vs O)</h3>

        <div class="question">
          <div class="qtitle">Question 1: How do you usually get things done?</div>
          <div class="options">
            <label class="option"><input type="radio" name="env1" value="A"> I adapt to whatever’s happening, improvise, and change my plan if needed.</label>
            <label class="option"><input type="radio" name="env1" value="O"> I make systems, stick to plans, and like predictable routines.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 2: When faced with a new task, what is your instinct?</div>
          <div class="options">
            <label class="option"><input type="radio" name="env2" value="O"> Draft a structured plan and follow it carefully.</label>
            <label class="option"><input type="radio" name="env2" value="A"> Jump in and figure it out as I go.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 3: Which describes you best at work or school?</div>
          <div class="options">
            <label class="option"><input type="radio" name="env3" value="A"> I thrive in dynamic, unpredictable environments.</label>
            <label class="option"><input type="radio" name="env3" value="O"> I excel where rules and procedures are clear.</label>
          </div>
        </div>
      </section>

      <section aria-labelledby="cog">
        <h3 id="cog">II. Cognition (C vs D vs L) — 7 questions</h3>
        <div class="question">
          <div class="qtitle">Question 1: When solving a problem, what is your approach?</div>
          <div class="options">
            <label class="option"><input type="radio" name="c1" value="D"> Generate lots of ideas before choosing.</label>
            <label class="option"><input type="radio" name="c1" value="L"> Find a lateral way that works without following the instruction to the letter.</label>
            <label class="option"><input type="radio" name="c1" value="C"> Focus on finding the one correct solution.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 2: How do you usually brainstorm?</div>
          <div class="options">
            <label class="option"><input type="radio" name="c2" value="L"> Challenge assumptions and create new frameworks.</label>
            <label class="option"><input type="radio" name="c2" value="C"> Analyze and narrow down the best options.</label>
            <label class="option"><input type="radio" name="c2" value="D"> Explore as many possibilities as possible.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 3: Which fits your thinking style?</div>
          <div class="options">
            <label class="option"><input type="radio" name="c3" value="C"> Logical, precise, focused on correctness.</label>
            <label class="option"><input type="radio" name="c3" value="L"> Innovative, paradigm-shifting, unconventional.</label>
            <label class="option"><input type="radio" name="c3" value="D"> Flexible, creative, wide-ranging.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 4: When approaching a new project, you…</div>
          <div class="options">
            <label class="option"><input type="radio" name="c4" value="L"> Consider if you should be doing the project at all.</label>
            <label class="option"><input type="radio" name="c4" value="D"> Think of multiple ways it could go before starting.</label>
            <label class="option"><input type="radio" name="c4" value="C"> Break it into clear, structured steps.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 5: When learning something new you want, you…</div>
          <div class="options">
            <label class="option"><input type="radio" name="c5" value="C"> Prefer step-by-step guidance and rules.</label>
            <label class="option"><input type="radio" name="c5" value="L"> Question if the traditional method is even the right one.</label>
            <label class="option"><input type="radio" name="c5" value="D"> Jump in, experiment, and see what works.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 6: When others debate, you…</div>
          <div class="options">
            <label class="option"><input type="radio" name="c6" value="D"> Explore many ideas and perspectives.</label>
            <label class="option"><input type="radio" name="c6" value="C"> Seek logical resolution and correctness.</label>
            <label class="option"><input type="radio" name="c6" value="L"> Challenge the whole premise of the debate.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 7: When forced to choose, you…</div>
          <div class="options">
            <label class="option"><input type="radio" name="c7" value="C"> Stick to logical analysis.</label>
            <label class="option"><input type="radio" name="c7" value="D"> Explore creative possibilities.</label>
          </div>
        </div>
      </section>

      <section aria-labelledby="exec">
        <h3 id="exec">III. Execution (T vs W)</h3>
        <div class="question">
          <div class="qtitle">Question 1: Which feels more satisfying?</div>
          <div class="options">
            <label class="option"><input type="radio" name="e1" value="W"> Doing something step by step following already created rules.</label>
            <label class="option"><input type="radio" name="e1" value="T"> Designing the perfect plan or system to make others do it.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 2: When you start a project, what excites you most?</div>
          <div class="options">
            <label class="option"><input type="radio" name="e2" value="T"> Figuring out the strategy and ideas, brainstorm first then work later.</label>
            <label class="option"><input type="radio" name="e2" value="W"> Seeing the results as quickly as possible, work first then brainstorm later if needed.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 3: How do you measure success?</div>
          <div class="options">
            <label class="option"><input type="radio" name="e3" value="W"> Practically, the outcome is complete and usable.</label>
            <label class="option"><input type="radio" name="e3" value="T"> Conceptually, my blueprint or model is flawless.</label>
          </div>
        </div>
      </section>

      <section aria-labelledby="social">
        <h3 id="social">IV. Social (P vs Q)</h3>
        <div class="question">
          <div class="qtitle">Question 1: Where do you get energy?</div>
          <div class="options">
            <label class="option"><input type="radio" name="s1" value="Q"> Thinking quietly on your own.</label>
            <label class="option"><input type="radio" name="s1" value="P"> Being around others, talking, and sharing ideas.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 2: When you need to make a decision, how do you process it?</div>
          <div class="options">
            <label class="option"><input type="radio" name="s2" value="P"> Discuss with people to refine ideas.</label>
            <label class="option"><input type="radio" name="s2" value="Q"> Reflect internally and analyze quietly.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 3: Which fits your social style best?</div>
          <div class="options">
            <label class="option"><input type="radio" name="s3" value="Q"> Reserved, introspective, needs alone time to recharge.</label>
            <label class="option"><input type="radio" name="s3" value="P"> Outgoing, expressive, energized by interactions.</label>
          </div>
        </div>
      </section>

      <section aria-labelledby="temp">
        <h3 id="temp">V. Temperament (SL vs SK)</h3>
        <div class="question">
          <div class="qtitle">Question 1: How do your moods behave usually?</div>
          <div class="options">
            <label class="option"><input type="radio" name="t1" value="SK"> Mostly stable, rarely swings dramatically.</label>
            <label class="option"><input type="radio" name="t1" value="SL"> They rise and fall naturally; dynamic.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 2: How do you react to stress or excitement?</div>
          <div class="options">
            <label class="option"><input type="radio" name="t2" value="SL"> Emotional highs and lows come naturally.</label>
            <label class="option"><input type="radio" name="t2" value="SK"> Stay calm, composed, and consistent.</label>
          </div>
        </div>

        <div class="question">
          <div class="qtitle">Question 3: Which describes your energy rhythm?</div>
          <div class="options">
            <label class="option"><input type="radio" name="t3" value="SK"> Steady and reliable; energy level consistent.</label>
            <label class="option"><input type="radio" name="t3" value="SL"> Cycles of highs and lows energize me.</label>
          </div>
        </div>

        <div class="note">Note: the quiz shows the technical code (example: ALTQ-SK) to participants after they click Get Result.</div>
      </section>
  
  <div class="controls">
    <button id="getResult">Get Result</button>
    <button id="resetBtn" type="button" class="secondary">Reset</button>
  </div>

  <div id="incompleteAlert" class="alert" role="alert">Please answer all questions before getting a result.</div>

  <div id="resultCard" class="result" role="status" aria-live="polite">
    <div class="code" id="resultCode"></div>
    <h2 id="resultName"></h2>
    <div id="resultNote" class="muted"></div>

    <!-- Percent summary -->
    <div style="margin-top:12px">
      <div><strong>Environment</strong> <span id="envChosen"></span> <span id="envPct" class="muted"></span>
        <div class="bar-wrap"><div id="envBar" class="bar"></div></div>
      </div>

      <div style="margin-top:10px"><strong>Cognition</strong> <span id="cogChosen"></span>
        <div style="display:flex;gap:8px;margin-top:6px">
          <div style="flex:1">
            <div style="font-size:12px">C <span id="cC" class="muted"></span></div>
            <div class="bar-wrap"><div id="cCbar" class="bar"></div></div>
          </div>
          <div style="flex:1">
            <div style="font-size:12px">D <span id="cD" class="muted"></span></div>
            <div class="bar-wrap"><div id="cDbar" class="bar"></div></div>
          </div>
          <div style="flex:1">
            <div style="font-size:12px">L <span id="cL" class="muted"></span></div>
            <div class="bar-wrap"><div id="cLbar" class="bar"></div></div>
          </div>
        </div>
      </div>

      <div style="margin-top:10px"><strong>Execution</strong> <span id="exeChosen"></span> <span id="exePct" class="muted"></span>
        <div class="bar-wrap"><div id="exeBar" class="bar"></div></div>
      </div>

      <div style="margin-top:10px"><strong>Social</strong> <span id="socChosen"></span> <span id="socPct" class="muted"></span>
        <div class="bar-wrap"><div id="socBar" class="bar"></div></div>
      </div>

      <div style="margin-top:10px"><strong>Temperament</strong> <span id="tempChosen"></span> <span id="tempPct" class="muted"></span>
        <div class="bar-wrap"><div id="tempBar" class="bar"></div></div>
      </div>
    </div>

    <div style="margin-top:12px">
      <a id="resultLink" href="#" style="font-weight:700;color:#000;text-decoration:underline">Open archetype page</a>
    </div>
  </div>

 <script>
  // Auto-redirect delay (milliseconds). Edit this to change how long the result is shown before redirect.
  const AUTO_REDIRECT_DELAY_MS = 700;

  // colour map (exact)
  const colorMap = {
    "Enigma":"#2b2b2b","Codebreaker":"#2b2b2b","Clockmaker":"#2b2b2b","Theorist":"#2b2b2b","Mastermind":"#2b2b2b","Scholastic":"#2b2b2b",
    "Canonist":"#acb0ff","Legislator":"#acb0ff","Architect":"#acb0ff","Director":"#acb0ff","Orchestrator":"#acb0ff","Taskmaster":"#acb0ff",
    "Loremaster":"#a2f1a1","Visionary":"#a2f1a1","Inventor":"#a2f1a1","Explorer":"#a2f1a1","Investigator":"#a2f1a1","Tinkerer":"#a2f1a1",
    "Ritualist":"#c592f2","Conservator":"#c592f2","Collector":"#c592f2","Crafter":"#c592f2","Steward":"#c592f2","Artist":"#c592f2",
    "Guardian":"#fe9d5d","Confessor":"#fe9d5d","Sage":"#fe9d5d","Counselor":"#fe9d5d","Facilitator":"#fe9d5d","Instructor":"#fe9d5d",
    "Disruptor":"#FF5C5C","Provocateur":"#FF5C5C","Reformer":"#FF5C5C","Game-Changer":"#FF5C5C","Innovator":"#FF5C5C","Trickster":"#FF5C5C",
    "Gamemaster":"#f4a4ef","Sophist":"#f4a4ef","Optimizer":"#f4a4ef","Hacker":"#f4a4ef","Improviser":"#f4a4ef","Magician":"#f4a4ef",
    "Purist":"#ffff85","Diagnostician":"#ffff85","Artificier":"#ffff85","Engineer":"#ffff85","Master":"#ffff85","Artisan":"#ffff85"
  };

  const archetypeMap = {
    "ALTQ-SK":"Enigma","OLTQ-SK":"Codebreaker","ODTQ-SK":"Clockmaker","ADTQ-SK":"Theorist","ACTQ-SK":"Mastermind",
    "OLTP-SK":"Scholastic","OCTQ-SK":"Canonist","OCTP-SK":"Legislator","ACTP-SK":"Architect","OCTP-SL":"Director",
    "ACTP-SL":"Orchestrator","OCWP-SK":"Taskmaster","ODTQ-SL":"Loremaster","ADTQ-SL":"Visionary","ODWQ-SK":"Inventor",
    "ADWQ-SK":"Explorer","ODWP-SK":"Investigator","ADWP-SL":"Tinkerer","OCWQ-SL":"Ritualist","OLWQ-SL":"Conservator",
    "ODWQ-SL":"Collector","ACWQ-SL":"Crafter","ALWQ-SL":"Steward","ADWQ-SL":"Artist","OCTQ-SL":"Guardian",
    "OLTQ-SL":"Confessor","ALTQ-SL":"Sage","ACTQ-SL":"Counselor","ODTP-SL":"Facilitator","ODWP-SL":"Instructor",
    "ALTP-SK":"Disruptor","ADTP-SK":"Provocateur","OLTP-SL":"Reformer","ALTP-SL":"Game-Changer","ADTP-SL":"Innovator",
    "ALWP-SL":"Trickster","ODTP-SK":"Gamemaster","OLWP-SK":"Sophist","ALWQ-SK":"Optimizer","ALWP-SK":"Hacker",
    "ADWP-SK":"Improviser","OLWP-SL":"Magician","OCWQ-SK":"Purist","OLWQ-SK":"Diagnostician","ACWQ-SK":"Artificier",
    "ACWP-SK":"Engineer","OCWP-SL":"Master","ACWP-SL":"Artisan"
  };

  function filenameFromName(name){
    return name.toLowerCase().replace(/\s+/g,'-').replace(/[^\w\-]/g,'') + '.html';
  }

  // match prefix followed by digits only (e.g. e1, e2, e3)
  function uniqueNamesFor(prefix){
    const els = Array.from(document.querySelectorAll('input[name]'));
    const re = new RegExp('^' + prefix + '\\d+$'); // prefix then at least one digit
    const names = new Set(els.map(x => x.name).filter(n => re.test(n)));
    return Array.from(names);
  }

  function getValue(name){
    const el = document.querySelector(`input[name="${name}"]:checked`);
    return el ? el.value : null;
  }

  function allAnswered(){
    const groups = [
      ...uniqueNamesFor('env'),
      ...uniqueNamesFor('c'),
      ...uniqueNamesFor('e'),
      ...uniqueNamesFor('s'),
      ...uniqueNamesFor('t')
    ];
    const uniq = Array.from(new Set(groups));
    return uniq.every(n => getValue(n) !== null);
  }

  function computePercent(num,den){
    if(den===0) return 0;
    return Math.round((num/den)*100);
  }

  function computeResult(){
    document.getElementById('incompleteAlert').style.display='none';
    if(!allAnswered()){
      document.getElementById('incompleteAlert').style.display='block';
      document.getElementById('resultCard').style.display='none';
      return;
    }

    // Environment
    const envNames = uniqueNamesFor('env');
    const envVals = envNames.map(n => getValue(n));
    const envTotal = envVals.length;
    const aCount = envVals.filter(v=>v==='A').length;
    const oCount = envTotal - aCount;
    const envChosen = aCount >= Math.ceil(envTotal/2) ? 'A' : 'O';
    const envPct = envChosen==='A' ? computePercent(aCount, envTotal) : computePercent(oCount, envTotal);

    // Cognition
    const cNames = uniqueNamesFor('c');
    const cVals = cNames.map(n => getValue(n));
    const cTotal = cVals.length;
    const counts = {C:0,D:0,L:0};
    cVals.forEach(v=>{
      if(v==='C') counts.C++;
      else if(v==='D') counts.D++;
      else if(v==='L') counts.L++;
    });
    const C = counts.C, D = counts.D, L = counts.L;
    let cog;
    if(C===3 && D===3 && L===1) cog='L';
    else {
      const max = Math.max(C,D,L);
      if(C> D && C> L) cog='C';
      else if(D> C && D> L) cog='D';
      else if(L> C && L> D) cog='L';
      else {
        if(L===max) cog='L';
        else if(D===max) cog='D';
        else cog='C';
      }
    }
    const pctC = computePercent(C,cTotal);
    const pctD = computePercent(D,cTotal);
    const pctL = computePercent(L,cTotal);

    // Execution
    const eNames = uniqueNamesFor('e');
    const eVals = eNames.map(n => getValue(n));
    const eTotal = eVals.length;
    const tCount = eVals.filter(v=>v==='T').length;
    const wCount = eTotal - tCount;
    const exec = tCount >= Math.ceil(eTotal/2) ? 'T' : 'W';
    const execPct = exec==='T' ? computePercent(tCount,eTotal) : computePercent(wCount,eTotal);

    // Social
    const sNames = uniqueNamesFor('s');
    const sVals = sNames.map(n => getValue(n));
    const sTotal = sVals.length;
    const pCount = sVals.filter(v=>v==='P').length;
    const qCount = sTotal - pCount;
    const social = pCount >= Math.ceil(sTotal/2) ? 'P' : 'Q';
    const socialPct = social==='P' ? computePercent(pCount,sTotal) : computePercent(qCount,sTotal);

    // Temperament
    const tNames = uniqueNamesFor('t');
    const tVals = tNames.map(n => getValue(n));
    const tTotal = tVals.length;
    const skCount = tVals.filter(v=>v==='SK').length;
    const slCount = tTotal - skCount;
    const temperament = skCount >= Math.ceil(tTotal/2) ? 'SK' : 'SL';
    const tempPct = temperament==='SK' ? computePercent(skCount,tTotal) : computePercent(slCount,tTotal);

    const prefix = `${envChosen}${cog}${exec}${social}`;
    const fullCode = `${prefix}-${temperament}`;

    let archetype = archetypeMap[fullCode] || null;
    if(!archetype){
      const keys = Object.keys(archetypeMap);
      const prefixMatches = keys.filter(k => k.startsWith(prefix));
      if(prefixMatches.length >= 1){
        archetype = archetypeMap[prefixMatches[0]] + (prefixMatches.length > 1 ? ' (close/ambiguous match)' : ' (close match)');
      }
    }

    const cleanName = archetype ? archetype.replace(' (close/ambiguous match)','').replace(' (close match)','') : null;
    const targetFile = cleanName ? filenameFromName(cleanName) : null;

    const resultData = {
      code: fullCode,
      finalType: cleanName || null,
      env: { chosen: envChosen, pct: envPct, counts: {A: aCount, O: oCount, total: envTotal} },
      cognition: { chosen: cog, pcts: {C: pctC, D: pctD, L: pctL}, counts: {C: C, D: D, L: L}, total: cTotal },
      execution: { chosen: exec, pct: execPct, counts: {T: tCount, W: wCount, total: eTotal} },
      social: { chosen: social, pct: socialPct, counts: {P: pCount, Q: qCount, total: sTotal} },
      temperament: { chosen: temperament, pct: tempPct, counts: {SK: skCount, SL: slCount, total: tTotal} },
      archetypeName: archetype
    };

    try { // Save to sessionStorage *and* localStorage to survive tab/navigation differences
console.log('computeResult() reached — preparing to save resultData:', resultData);

try {
  const json = JSON.stringify(resultData);
  console.log('Serialized JSON length:', json.length);

  sessionStorage.setItem('quizResult', json);
  console.log('sessionStorage.setItem -> OK');

  localStorage.setItem('quizResult', json);
  console.log('localStorage.setItem -> OK');

  localStorage.setItem('quizResult_ok', '1');
  console.log('Saved quizResult_ok flag in localStorage -> OK');

} catch (e) {
  console.error('Failed to save quizResult:', e);
}

; } catch(e){ console.warn(e); }

    const color = (cleanName && colorMap[cleanName]) ? colorMap[cleanName] : '#111';

    document.getElementById('resultCode').textContent = fullCode;
    document.getElementById('resultName').textContent = archetype || (fullCode + ' — (no archetype found)');
    document.getElementById('resultNote').textContent = 'Percentages below show composition of answers for each axis.';

    function clamp(n){ return Math.max(0, Math.min(100, n)); }
    function applyBar(id, pct){
      const el = document.getElementById(id);
      if(el){ el.style.width = clamp(pct) + '%'; el.style.backgroundColor = color; }
    }

    document.getElementById('envChosen').textContent = envChosen==='A' ? 'Adaptive (A)' : 'Ordered (O)';
    document.getElementById('envPct').textContent = envPct + '%';
    applyBar('envBar', envPct);

    document.getElementById('cogChosen').textContent = cog;
    document.getElementById('cC').textContent = pctC + '%';
    document.getElementById('cD').textContent = pctD + '%';
    document.getElementById('cL').textContent = pctL + '%';
    applyBar('cCbar', pctC); applyBar('cDbar', pctD); applyBar('cLbar', pctL);

    document.getElementById('exeChosen').textContent = exec==='T' ? 'Thinker (T)' : 'Worker (W)';
    document.getElementById('exePct').textContent = execPct + '%';
    applyBar('exeBar', execPct);

    document.getElementById('socChosen').textContent = social==='P' ? 'Public (P)' : 'Quiet (Q)';
    document.getElementById('socPct').textContent = socialPct + '%';
    applyBar('socBar', socialPct);

    document.getElementById('tempChosen').textContent = temperament==='SK' ? 'Cyclothymic (SK)' : 'Schizothymic (SL)';
    document.getElementById('tempPct').textContent = tempPct + '%';
    applyBar('tempBar', tempPct);

    const resultLink = document.getElementById('resultLink');
    if(targetFile){
      resultLink.href = targetFile;
      resultLink.textContent = 'Open archetype page (' + targetFile + ')';
    } else {
      resultLink.href = '#';
      resultLink.textContent = 'No archetype page available';
    }

    document.getElementById('resultCard').style.display = 'block';
    document.getElementById('resultCard').scrollIntoView({behavior:'smooth', block:'center'});

    // === Auto-redirect (enabled) ===
    if(targetFile){
      setTimeout(() => {
        // final navigation
        try { window.location.assign(targetFile); } catch(e){ console.warn('Redirect failed', e); }
      }, AUTO_REDIRECT_DELAY_MS);
    }
  }

  document.getElementById('getResult').addEventListener('click', function(e){ e.preventDefault(); computeResult(); });
  document.getElementById('resetBtn').addEventListener('click', function(){
    document.querySelectorAll('input[type=radio]').forEach(r => r.checked=false);
    document.getElementById('resultCard').style.display='none';
    document.getElementById('incompleteAlert').style.display='none';
    try { sessionStorage.removeItem('quizResult'); } catch(e){}
	// SAVE RESULT TO LOCAL STORAGE
localStorage.setItem('lastResult', JSON.stringify(resultData));

  });
</script>

</body>
</html>

